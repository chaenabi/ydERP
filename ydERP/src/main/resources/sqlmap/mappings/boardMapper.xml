<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="stock">
	<resultMap type="board" id="boardResult">
		<id property="seq" column="seq" />
		<result property="title" column="title" />
		<result property="writer" column="writer" />
		<result property="content" column="content" />
		<result property="regDate" column="regDate" />
		<result property="cnt" column="cnt" />
		<result property="uploadFileName" column="upload_file_name" />
	</resultMap>
	<!-- <select id="getBoardList" resultMap="boardResult"> -->
	<select id="getStockList" resultType="stock">
		<![CDATA[
		select a.* from ( select rownum rn, b.* from (
		SELECT seq
		      ,title
		      ,writer
		      ,content
		      ,regdate
		      ,cnt
		      ,upload_file_name
		FROM   board
		]]>
		<where>
			<if test="searchKeyword != null and searchKeyword != '' ">
				<if test="searchCondition == 'title' ">
					AND title like '%' || #{searchKeyword} || '%'
				</if>
				<if test="searchCondition == 'content' ">
					AND content like '%' || #{searchKeyword} || '%'
				</if>
			</if>
		</where>
		ORDER BY seq DESC
		) b ) a where rn between #{first} and #{last}
	</select>
	<!-- -->
	<select id="getBoard" resultType="board" parameterType="board">
		<![CDATA[
		SELECT * FROM board WHERE  seq = #{seq}
		]]>
	</select>
	<!-- -->
	<select id="getCount" resultType="int" parameterType="board">
		SELECT Count(*) FROM board
		<where>
			<if test="searchKeyword != null and searchKeyword != '' ">
				<if test="searchCondition == 'title' ">
					AND title like '%' || #{searchKeyword} || '%'
				</if>
				<if test="searchCondition == 'content' ">
					AND content like '%' || #{searchKeyword} || '%'
				</if>
			</if>
		</where>
	</select>
	<!-- -->
	<insert id="insertBoard" parameterType="board">
		<selectKey keyProperty="seq" resultType="int" order="BEFORE">
			select
			nvl(max(seq),0) + 1 from board
		</selectKey>
		INSERT INTO board
				(seq
				,title
				,writer
				,content
				,regdate
		<if test="uploadFileName != null">
			,upload_file_name
		</if>
				)
				VALUES
				(#{seq}
				,#{title}
				,#{writer}
				,#{content}
				,SYSDATE
		<if test="uploadFileName!=null">
			,#{uploadFileName}
		</if>
				)
	</insert>
	<!-- -->
	<insert id="insertBoard2" parameterType="board" statementType="CALLABLE">
		<![CDATA[
		{call board_ins_proc(#{title}
							,#{writer}
							,#{content}
							,#{seq, mode=OUT, jdbcType=NUMERIC, javaType=java.lang.Integer}
							,#{outMsg, mode=OUT, jdbcType=VARCHAR, javaType=String}
		)}
		]]>
	</insert>
	<!-- -->
	<update id="updateBoard" parameterType="board">
		<![CDATA[
		UPDATE board
		SET    title   = #{title}
		      ,content = #{content}
		      ,writer  = #{writer}
		WHERE  seq = #{seq}
		]]>
	</update>
	<!-- -->
	<delete id="deleteBoard" parameterType="board">
		<![CDATA[
		DELETE board
		WHERE  seq = #{seq}
		]]>
	</delete>
	<!-- -->
	<delete id="deleteBoardList" parameterType="list">
		DELETE board
		WHERE seq IN
		<foreach item="item" collection="list" open="(" separator=","
			close=")">
			#{item}
		</foreach>
	</delete>
	<!-- -->
</mapper>