<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sales">

	<!-- 판매 내역 전체 조회 -->
	<select id="getSaleList" resultType="sales">
		SELECT * 
		FROM SALES 
		WHERE ORDER_PERMIT = 'Y' 
		ORDER BY SALE_CODE
	</select> 

	<!-- 판매 내역 상세 조회 -->
	<!-- JQGRID MASTER에서 선택된 ROW의 SALE_CODE값을 가져와서 DETAIL을 조회 -->
	<select id="getSaleDetail" resultType="saleDetails">
		SELECT * 
		FROM SALE_DETAILS 
		WHERE SALE_CODE = #{saleCode} 
		ORDER BY SALE_DETAIL_CODE
	</select>
	
	<!-- 주문 등록 : 주문 기본 정보 -->
	<insert id="insertOrder" parameterType="sales">
		INSERT INTO SALES (	SALE_CODE
							, SALE_DATE
							, CUSTOMER_CODE
							, SALE_COST
							, DELIVERY_ADDR
							, DELIVERY_STATUS
							, PAY_STATUS
							, ORDER_PERMIT )
		VALUES ( #{saleCode}
				, SYSDATE
				, #{customerCode}
				, #{saleCost}
				, #{deliveryAddr}
				, 'N'
				, 'N'
				, 'N'		)
	</insert>
	
	
	<!-- 주문 등록 : 주문 상세 정보 -->
	<insert id="insertOrderDetail" parameterType="saleDetails">
	
	</insert>
	
	
	
	
	<!-- 주문 상세 추가 -->
	
	
	
	
	<!-- 주문 수정 -->
	<!-- 수정 가능한 칼럼 : 마스터의 DELIVERY_ADDR-->
	<!-- 마스터에서 수정되어야 할 칼럼 : SALE_COST -->
	<!-- 주문 승인이 N으로 초기화된다 -->
	
	<!-- 주문 취소 -->
	
	
	
	<!-- 미승인 주문 기본 조회 -->
	<select id="getOrderList" resultType="sales">
		SELECT * 
		FROM SALES 
		WHERE ORDER_PERMIT = 'N' 
		ORDER BY SALE_CODE
	</select>

	<!-- 미승인 주문 상세 조회 -->
	<!-- JQGRID MASTER에서 선택된 ROW의 SALE_CODE값을 가져와서 DETAIL을 조회 -->
	<select id="getOrderDetail" resultType="saleDetails">
		SELECT * 
		FROM SALE_DETAILS 
		WHERE SALE_CODE = #{saleCode} 
		ORDER BY SALE_DETAIL_CODE
	</select>
	
	<!-- 주문 승인 -->
	<!-- 주문이 승인될 때 결정되는 칼럼(NULL처리) : SALE_DATE, DELIVERY_EMP, WAREHOUSE-->
	<!-- 주문이 승인될 때 변경되는 칼럼 : ORDER_PERMIT -->
	<!-- SALE_DATE : 주문 승인 일자 -->
	<!-- DELIVERY_EMP : 주문을 승인할 때 배송가능한 사원을 선택 -->
	<!-- WAREHOUSE : 주문을 승인할 때 출하창고를 선택 -->
	<update id="updateOrderStatus" parameterType="sales">
		UPDATE SALES 
		SET SALE_DATE = SYSDATE
			, DELIVERY_EMP = #{deliveryEmp}
			, WAREHOUSE = #{warehouse}
			, ORDER_PERMIT = 'Y';
	</update>
	
	<!-- 미승인 주문 삭제 : 주문 상세 정보 -->
	<delete id="deleteOrderDetail" parameterType="list">
		DELETE FROM SALE_DETAILS 
		WHERE SALE_CODE IN 
			<foreach item="itemOrderDetail" collection="list" open="(" separator="," close=")">
				#{itemOrderDetail}
			</foreach>
	</delete>
	
	<!-- 미승인 주문 삭제 : 주문 기본 정보 -->
	<delete id="deleteOrderList" parameterType="list">	
		DELETE FROM SALES 
		WHERE SALE_CODE IN 
			<foreach item="itemOrderList" collection="list" open="(" separator="," close=")">
				#{itemOrderList}
			</foreach>
	</delete>

</mapper>