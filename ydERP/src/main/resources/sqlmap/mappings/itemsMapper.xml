<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="items">

	<!-- <select id="getitemsList" resultMap="itemsResult"> -->
	<select id="getItemsList" resultType="items">
		<![CDATA[
		
		SELECT i.item_code
		      ,i.item_name
		      ,i.uom
		      ,i.in_qty
		      ,i.supply_price
		      ,i.selling_price
		      ,i.item_tax
		      ,i.expire_date
		      ,i.vendor_code		      
		FROM   items i
		ORDER BY item_code DESC
		]]>


	</select>
	<!-- -->
	<select id="getItems" resultType="items" parameterType="items">
		<![CDATA[
		SELECT * FROM items 
		]]>
		<where>
			<if test="searchKeyword != null and searchKeyword != '' ">
				<if test="searchCondition == 'item_code' ">
					AND item_code like '%' || #{searchKeyword} || '%'
				</if>
				<if test="searchCondition == 'item_name' ">
					AND item_name like '%' || #{searchKeyword} || '%'
				</if>
			</if>
		</where>

	</select>
	<!-- -->
	<select id="getCount" resultType="int" parameterType="items">
		SELECT Count(*) FROM items
		<where>
			<if test="searchKeyword != null and searchKeyword != '' ">
				<if test="searchCondition == 'item_code' ">
					AND item_code like '%' || #{searchKeyword} || '%'
				</if>
				<if test="searchCondition == 'item_name' ">
					AND item_name like '%' || #{searchKeyword} || '%'
				</if>
			</if>
		</where>
	</select>
	<!-- -->
	<!-- <insert id="insertItems" parameterType="items"> INSERT INTO items (item_code 
		,item_name ,uom ,in_qty ,supply_price ,selling_price ,item_tax ,expire_date 
		,vendor_code ) values (#{itemCode},#{itemName},#{uom},#{inQty},#{supplyPrice}, 
		#{sellingPrice},#{itemTax},#{expireDate},#{vendorCode}) </insert> -->
	<!-- -->
	<insert id="insertItems" parameterType="items" statementType="CALLABLE">
		<![CDATA[
		{call items_ins_proc( #{pGroup1}    
                             ,#{pGroup2}      
                             ,#{pGroup3}      
                             ,#{itemName}     
                             ,#{uom}        
                             ,#{inQty}       
                             ,#{supplyPrice}  
                             ,#{sellingPrice} 
                             ,#{itemTax}       
                             ,#{expireDate}
                             ,#{vendorCode}  
                             ,#{minQty}      
                             ,#{msg, mode=OUT, jdbcType=VARCHAR, javaType=string}          
						
		)}
		]]>
	</insert>
	<!-- -->
	<update id="updateItems" parameterType="items">
		<![CDATA[
		UPDATE items
		SET   item_name = #{itemName}
		      ,uom  = #{uom}
		      ,in_qty = #{inQty}
		      ,supply_price  = #{supplyPrice}
		      ,selling_price = #{sellingPrice}
		      ,item_tax  = #{itemTax}
		      ,expire_date = #{expireDate}
		      ,vendor_code  = #{vendorCode}
		      
		      
		      
		      
		WHERE  item_code = #{itemCode}
		]]>
	</update>
	<!-- -->
	<delete id="deleteItems" parameterType="items">

		DELETE items
		WHERE item_code = #{itemCode}

	</delete>
	<!-- -->
	<delete id="deleteItemsList" parameterType="list">
		DELETE items
		WHERE item_code IN
		<foreach item="item" collection="list" open="(" separator=","
			close=")">
			#{items}
		</foreach>
	</delete>
	<!-- -->


	<!-- 여기서부터 판매업체관리 -->
	<select id="getCustomerList" resultType="com.yedam.erp.items.CustomerVO">
		<![CDATA[
		
		SELECT customer_code
		      ,customer_name
		      ,customer_owner
		      ,customer_loc
		      ,customer_phone
		      ,customer_bank
		      ,customer_account
		      ,customer_bankowner
		     		      
		FROM  customers
		WHERE use_flag = 'Y'
		ORDER BY customer_code DESC
		]]>
	</select>

	<!-- JqGrid 클릭 이벤트시 가져올 판매업체 한 개의 정보 -->
	<select id="getCustomer" resultType="com.yedam.erp.items.CustomerVO">
	
		
		SELECT customer_code
		      ,customer_name
		      ,customer_owner
		      ,customer_loc
		      ,customer_phone
		      ,customer_pw
		      ,customer_bank
		      ,customer_account
		      ,customer_bankowner
		FROM  customers
		WHERE customer_code = #{customerCode}
			

	</select>	

	<!-- 판매업체 가입 -->
	<insert id="insertCustomer" parameterType="com.yedam.erp.items.CustomerVO">
		<![CDATA[
		insert into customers (customer_code, customer_name, customer_owner,
							   customer_loc, customer_phone, customer_pw, customer_bank, customer_account, customer_bankowner, use_flag) 
				      values (#{customerCode}    
                          	 ,#{customerName}      
                             ,#{customerOwner}      
                             ,#{customerLoc}     
                             ,#{customerPhone}
                             ,#{customerPw}
                             ,#{customerBank}     
                             ,#{customerAccount}
                             ,#{customerBankowner}         
                             ,'Y')
		
		]]>
	</insert>

	<!-- 판매업체 수정 -->
	<update id="updateCustomer" parameterType="com.yedam.erp.items.CustomerVO">

		UPDATE customers
		SET  customer_owner = #{customerOwner}
		    ,customer_loc = #{customerLoc}
		    ,customer_phone = #{customerPhone}
		    ,customer_pw = #{customerPw}
		    ,customer_bank = #{customerBank}
		    ,customer_account = #{customerAccount}
		    ,customer_bankowner = #{customerBankowner}
				
		WHERE customer_code = #{customerCode}

	</update>

	<!-- delete (거래 'N' 처리)  -->
	<update id="deleteCustomer" parameterType="com.yedam.erp.items.CustomerVO">

		UPDATE customers
		SET use_flag = 'N'
		WHERE customer_code = #{customerCode}

	</update>
	
	<select id="checkCustomerCode" parameterType="com.yedam.erp.items.CustomerVO">
	SELECT customer_code from customers where customer_code = #{customerCode}
	</select>
	
	  <select id="loginCheck" resultType="String">
        SELECT customer_owner AS customerOwner FROM customers
        WHERE customer_code = #{customerCode} AND customer_pw = #{customerPw}
    </select>
    
    <select id="viewCustomer" resultType="com.yedam.erp.items.CustomerVO">
        SELECT 
            customer_code AS customerCode,
            customer_name AS customerName,
            customer_owner AS customerOwner,
            customer_loc AS customerLoc,
            customer_bank AS customerBank,
            customer_account AS customerAccount,
            customer_bankowner AS customerBankowner
        FROM customers
        WHERE customer_code = #{customerCode} AND customer_pw = #{customerPw}
    </select>
	
	
</mapper>