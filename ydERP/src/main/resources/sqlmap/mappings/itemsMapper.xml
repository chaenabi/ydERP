<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="items">
	
	<!-- <select id="getitemsList" resultMap="itemsResult"> -->
	<select id="getItemsList" resultType="items">
		<![CDATA[
		
		SELECT item_code
		      ,item_name
		      ,uom
		      ,in_qty
		      ,supply_price
		      ,selling_price
		      ,item_tax
		      ,expire_date
		      ,vendor_code		      
		FROM   items
		]]>
		<where>
			<if test="searchKeyword != null and searchKeyword != '' ">
				<if test="searchCondition == 'item_code' ">
					AND item_code like '%' || #{searchKeyword} || '%'


				</if>
				<if test="searchCondition == 'item_name' ">
					AND item_name like '%' || #{searchKeyword} || '%'
				</if>
			</if>
		</where>
		ORDER BY item_code DESC

	
	</select>
	<!-- -->
	<select id="getItems" resultType="items" parameterType="items">
		<![CDATA[
		SELECT * FROM items 
		]]>
		<where>
			<if test="searchKeyword != null and searchKeyword != '' ">
				<if test="searchCondition == 'item_code' ">
					AND item_code like '%' || #{searchKeyword} || '%'
				</if>
				<if test="searchCondition == 'item_name' ">
					AND item_name like '%' || #{searchKeyword} || '%'
				</if>
			</if>
		</where>
		
	</select>
	<!-- -->
	<select id="getCount" resultType="int" parameterType="items">
		SELECT Count(*) FROM items
		<where>
			<if test="searchKeyword != null and searchKeyword != '' ">
				<if test="searchCondition == 'item_code' ">
					AND item_code like '%' || #{searchKeyword} || '%'
				</if>
				<if test="searchCondition == 'item_name' ">
					AND item_name like '%' || #{searchKeyword} || '%'
				</if>
			</if>
		</where>
	</select>
	<!-- -->
	<insert id="insertItems" parameterType="items">
		INSERT INTO items
		(item_code
		,item_name
		,uom
		,in_qty
		,supply_price
		,selling_price
		,item_tax
		,expire_date
		,vendor_code

		)
		values
		(#{itemCode},#{itemName},#{uom},#{inQty},#{supplyPrice},
		#{sellingPrice},#{itemTax},#{expireDate},#{vendorCode})
	</insert>
	<!-- -->
	<insert id="insertItems2" parameterType="items" statementType="CALLABLE">
		<![CDATA[
		create or replace PROCEDURE items_ins_proc(p_group1        IN VARCHAR2
                                          ,p_group2        IN VARCHAR2
                                          ,p_group3        IN VARCHAR2
                                          ,p_item_name     IN VARCHAR2
                                          ,p_uom           IN VARCHAR2
                                          ,p_in_qty        IN NUMBER
                                          ,p_supply_price  IN NUMBER
                                          ,p_selling_price IN NUMBER
                                          ,p_tax           IN NUMBER
                                          ,p_expire_date   IN VARCHAR2
                                          ,p_vendor_code   IN VARCHAR2
                                          ,p_min_qty       IN NUMBER
                                          ,p_msg           OUT VARCHAR2) IS

    v_new_no        NUMBER := 0;
    v_new_item_name VARCHAR2(8);

BEGIN

    SELECT COUNT(*) + 1
    INTO   v_new_no
    FROM   items
    WHERE  SUBSTR(item_code
                 ,1
                 ,3) = p_group1 || p_group2 || p_group3;

    v_new_item_name := p_group1 || p_group2 || p_group3 ||
                       LPAD(v_new_no
                           ,5
                           ,'0');

    INSERT INTO items
        (item_code
        ,item_name
        ,uom
        ,in_qty
        ,supply_price
        ,selling_price
        ,item_tax
        ,expire_date
        ,vendor_code
        ,min_qty)
    VALUES
        (v_new_item_name
        ,p_item_name
        ,p_uom
        ,p_in_qty
        ,p_supply_price
        ,p_selling_price
        ,p_tax
        ,p_expire_date
        ,p_vendor_code
        ,p_min_qty);

    p_msg := 'success';

END items_ins_proc;

		]]>
	</insert>
	<!-- -->
	<update id="updateItems" parameterType="items">
		<![CDATA[
		UPDATE items
		SET   item_name = #{itemName}
		      ,uom  = #{uom}
		      ,in_qty = #{inQty}
		      ,supply_price  = #{supplyPrice}
		      ,selling_price = #{sellingPrice}
		      ,item_tax  = #{itemTax}
		      ,expire_date = #{expireDate}
		      ,vendor_code  = #{vendorCode}
		      
		      
		      
		      
		WHERE  item_code = #{itemCode}
		]]>
	</update>
	<!-- -->
	<delete id="deleteItems" parameterType="items">
		<![CDATA[
		DELETE items
		WHERE  item_code = #{itemCode}
		]]>
	</delete>
	<!-- -->
	<delete id="deleteItemsList" parameterType="list">
		DELETE items
		WHERE item_code IN
		<foreach item="item" collection="list" open="(" separator=","
			close=")">
			#{items}
		</foreach>
	</delete>
	<!-- -->
</mapper>