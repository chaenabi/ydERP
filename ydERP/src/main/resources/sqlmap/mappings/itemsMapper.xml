<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="items">
	
	<!-- <select id="getitemsList" resultMap="itemsResult"> -->
	<select id="getItemsList" resultType="items">
		<![CDATA[
		
		SELECT item_code
		      ,item_name
		      ,uom
		      ,in_qty
		      ,supply_price
		      ,selling_price
		      ,item_tax
		      ,expire_date
		      ,vendor_code		      
		FROM   items
		]]>
		<where>
			<if test="searchKeyword != null and searchKeyword != '' ">
				<if test="searchCondition == 'item_code' ">
					AND item_code like '%' || #{searchKeyword} || '%'


				</if>
				<if test="searchCondition == 'item_name' ">
					AND item_name like '%' || #{searchKeyword} || '%'
				</if>
			</if>
		</where>
		ORDER BY item_code DESC

	
	</select>
	<!-- -->
	<select id="getItems" resultType="items" parameterType="items">
		<![CDATA[
		SELECT * FROM items 
		]]>
		<where>
			<if test="searchKeyword != null and searchKeyword != '' ">
				<if test="searchCondition == 'item_code' ">
					AND item_code like '%' || #{searchKeyword} || '%'
				</if>
				<if test="searchCondition == 'item_name' ">
					AND item_name like '%' || #{searchKeyword} || '%'
				</if>
			</if>
		</where>
		
	</select>
	<!-- -->
	<select id="getCount" resultType="int" parameterType="items">
		SELECT Count(*) FROM items
		<where>
			<if test="searchKeyword != null and searchKeyword != '' ">
				<if test="searchCondition == 'item_code' ">
					AND item_code like '%' || #{searchKeyword} || '%'
				</if>
				<if test="searchCondition == 'item_name' ">
					AND item_name like '%' || #{searchKeyword} || '%'
				</if>
			</if>
		</where>
	</select>
	<!-- -->
	<insert id="insertItems" parameterType="items">
		<selectKey keyProperty="item_code" resultType="int" order="BEFORE">
			select nvl(max(item_code),0) + 1 from items
		</selectKey>
		INSERT INTO items
		(item_code
		,item_name
		,uom
		,in_qty
		,supply_price
		,selling_price
		,item_tax
		,expire_date
		,vendor_code

		)
		values
		(#{itemCode},#{itemName},#{uom},#{inQty},#{supply_price},
		#{selling_price},#{item_tax},#{expire_date},#{vendor_code})
	</insert>
	<!-- -->
	<insert id="insertItems2" parameterType="items" statementType="CALLABLE">
		<![CDATA[
		{call items_ins_proc(#{item_name}
							,#{uom}
							,#{in_qty}
							,#{supply_price, mode=OUT, jdbcType=NUMERIC, javaType=java.lang.Integer}
							,#{selling_price, mode=OUT, jdbcType=VARCHAR, javaType=String}
							,#{supply_price, mode=OUT, jdbcType=NUMERIC, javaType=java.lang.Integer}
							,#{item_tax, mode=OUT, jdbcType=VARCHAR, javaType=String}
							,#{expire_date, mode=OUT, jdbcType=NUMERIC, javaType=java.lang.Integer}
							,#{vendor_code, mode=OUT, jdbcType=VARCHAR, javaType=String}
		)}
		]]>
	</insert>
	<!-- -->
	<update id="updateItems" parameterType="items">
		<![CDATA[
		UPDATE items
		SET   item_name = #{itemName}
		      ,uom  = #{uom}
		      ,in_qty = #{inQty}
		      ,supply_price  = #{supplyPrice}
		      ,selling_price = #{sellingPrice}
		      ,item_tax  = #{itemTax}
		      ,expire_date = #{expireDate}
		      ,vendor_code  = #{vendorCode}
		      
		      
		      
		      
		WHERE  item_code = #{itemCode}
		]]>
	</update>
	<!-- -->
	<delete id="deleteItems" parameterType="items">
		<![CDATA[
		DELETE items
		WHERE  item_code = #{itemCode}
		]]>
	</delete>
	<!-- -->
	<delete id="deleteItemsList" parameterType="list">
		DELETE items
		WHERE item_code IN
		<foreach item="item" collection="list" open="(" separator=","
			close=")">
			#{items}
		</foreach>
	</delete>
	<!-- -->
</mapper>